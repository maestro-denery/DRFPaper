From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Denery <dorofeevij@gmail.com>
Date: Sun, 29 May 2022 23:52:23 +0300
Subject: [PATCH] lifecycles


diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index 8bbb24eb8dae31851698457aef608aedca2a4fc3..62f87835d861ad5e25c04b930448a328888839d4 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -1169,6 +1169,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
     protected void runServer() {
         try {
             long serverStartTime = Util.getNanos(); // Paper
+			net.drf.drfpaper.lifecycle.ServerLifecycles.SERVER_STARTING.invoker().starting(); // DRFPaper - lifecycles
             if (this.initServer()) {
                 this.nextTickTime = Util.getMillis();
                 this.status.setDescription(new TextComponent(this.motd));
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index d32f82b13feed3909ede1da4d443449d5ac091ba..66822b2b78e1dcfafd6ab222cdc74957f41d5b80 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -45,6 +45,9 @@ import java.util.logging.Level;
 import java.util.logging.Logger;
 import java.util.stream.Collectors;
 import javax.imageio.ImageIO;
+
+import net.drf.event.Result;
+
 import net.minecraft.advancements.Advancement;
 import net.minecraft.commands.CommandSourceStack;
 import net.minecraft.commands.Commands;
@@ -420,12 +423,17 @@ public final class CraftServer implements Server {
             for (Plugin plugin : plugins) {
                 try {
                     String message = String.format("Loading %s", plugin.getDescription().getFullName());
+					// DRFPaper start - Lifecycles
+					final net.drf.event.Result result = net.drf.drfpaper.lifecycle.PluginLifecycles.PLUGIN_LOADING.invoker().pluginLoading(plugins, plugin, pluginFolder);
+					if (result == net.drf.event.Result.PASS || result == Result.FAIL) continue;
+					// DRFPaper end
                     plugin.getLogger().info(message);
                     plugin.onLoad();
                 } catch (Throwable ex) {
                     Logger.getLogger(CraftServer.class.getName()).log(Level.SEVERE, ex.getMessage() + " initializing " + plugin.getDescription().getFullName() + " (Is it up to date?)", ex);
                 }
             }
+			//
         } else {
             pluginFolder.mkdir();
         }
